#!/bin/sh

# Copyright (C) 1998, 2002, 2006-2007, 2010-2021 Free Software Foundation, Inc.

version="zless ($(pigz --version))"

usage="Usage: $0 [OPTION]... [FILE]...
Like 'less', but operate on the uncompressed contents of any compressed FILEs.

Options are the same as for 'less'.

Report bugs to <bug-gzip@gnu.org>."

case $1 in
  --help)
    printf '%s\n' "$usage" || exit 1
    exit
    ;;
  --version)
    printf '%s\n' "$version" || exit 1
    exit
    ;;
esac

if test "${LESSMETACHARS+set}" != set; then
  # Work around a bug in less 394 and earlier;
  # it mishandles the metacharacters '$%=~'.
  space=' '
  tab='	'
  newline='
'
  LESSMETACHARS="$space$tab$newline'"';*?"()<>[|&^`#\$%=~'
  export LESSMETACHARS
fi

less_version=$(less -V 2> /dev/null)
case $less_version in
  less' '45[1-9]* | \
    less' '4[6-9][0-9]* | \
    less' '[5-9][0-9][0-9]* | \
    less' '[1-9][0-9][0-9][0-9]*)
    check_exit_status='|'
    ;;
  *) check_exit_status='' ;;
esac
case $less_version in
  less' '429* | \
    less' '4[3-9][0-9]* | \
    less' '[5-9][0-9][0-9]* | \
    less' '[1-9][0-9][0-9][0-9]*)
    use_input_pipe_on_stdin='-'
    ;;
  *) use_input_pipe_on_stdin='' ;;
esac

LESSOPEN="|$check_exit_status${use_input_pipe_on_stdin}gzip -cdfq -- %s"
export LESSOPEN

exec less "$@"
